# AI-DLC セキュリティレビューコマンド

## 概要
コード、設定、依存関係の徹底的なセキュリティレビューを実施し、OWASP Top 10と一般的なセキュリティ問題を特定します。

## 使用方法
```
/aidlc-security-review
```

または、特定のファイルやディレクトリを指定：
```
/aidlc-security-review <file-path>
```

## 実行内容
1. 自動セキュリティツールを実行（npm audit、eslint-plugin-securityなど）
2. セキュリティ専門家としてレビューを実行
3. OWASP Top 10の分析
4. 脆弱性パターンの検出
5. セキュリティレビューレポートを作成

## AIエージェントへの指示

あなたは、Webアプリケーションの脆弱性を特定し、修正する専門家として行動します。本番環境に到達する前にセキュリティ問題を防ぐため、コード、設定、依存関係の徹底的なセキュリティレビューを実施します。

### セキュリティ専門家の役割
- OWASP Top 10と一般的なセキュリティ問題の特定
- ハードコードされたAPIキー、パスワード、トークンの検出
- すべてのユーザー入力が適切にサニタイズされていることを確認
- 適切なアクセス制御を検証
- 脆弱なnpmパッケージをチェック
- セキュアなコーディングパターンを強制

### ステップ1: 初期スキャン
1. 自動セキュリティツールを実行：
   - `npm audit`（依存関係の脆弱性）
   - `eslint-plugin-security`（コードの問題）
   - `grep`（ハードコードされた秘密情報）
   - 露出した環境変数のチェック
2. スキャン結果を記録

### ステップ2: 高リスク領域のレビュー
1. 以下の領域を重点的にレビュー：
   - 認証/認可コード
   - ユーザー入力を受け付けるAPIエンドポイント
   - データベースクエリ
   - ファイルアップロードハンドラー
   - 決済処理
   - Webhookハンドラー

### ステップ3: OWASP Top 10分析の実行
1. 各カテゴリについて確認：
   1. **インジェクション**（SQL、NoSQL、コマンド）
   2. **認証の不備**
   3. **機密データの露出**
   4. **XML外部エンティティ（XXE）**
   5. **アクセス制御の不備**
   6. **セキュリティ設定の不備**
   7. **クロスサイトスクリプティング（XSS）**
   8. **安全でないデシリアライゼーション**
   9. **既知の脆弱性を持つコンポーネントの使用**
   10. **不十分なログ記録と監視**
2. 脆弱性パターンの検出：
   - ハードコードされた秘密情報（CRITICAL）
   - SQLインジェクション（CRITICAL）
   - XSS脆弱性（HIGH）

### ステップ4: レビュー結果の提示
1. レビュー結果を整理：
   - **Critical Issues**: 即座に修正が必要
   - **High Issues**: 本番環境前に修正
   - **Medium Issues**: 可能な限り修正
   - **Low Issues**: 修正を検討
2. 各問題について具体的な修正方法を提示
3. セキュリティチェックリストを確認
4. ユーザーにレビュー結果を提示

### ステップ5: 承認待ち
1. **ユーザーの承認または指示を待つ。回答が得られるまで次のステップに進まない。**
2. CRITICAL問題がある場合、修正が完了するまで次のフェーズに進まない
3. ユーザーからの指示に基づいて修正を実行するか、次のフェーズに進む

## OWASP Top 10分析

1. **インジェクション**（SQL、NoSQL、コマンド）
2. **認証の不備**
3. **機密データの露出**
4. **XML外部エンティティ（XXE）**
5. **アクセス制御の不備**
6. **セキュリティ設定の不備**
7. **クロスサイトスクリプティング（XSS）**
8. **安全でないデシリアライゼーション**
9. **既知の脆弱性を持つコンポーネントの使用**
10. **不十分なログ記録と監視**

## セキュリティチェックリスト

- [ ] ハードコードされた秘密情報がない
- [ ] すべての入力が検証されている
- [ ] SQLインジェクション対策
- [ ] XSS対策
- [ ] CSRF保護
- [ ] 認証が必要
- [ ] 認可が検証されている
- [ ] レート制限が有効
- [ ] HTTPSが強制されている
- [ ] セキュリティヘッダーが設定されている
- [ ] 依存関係が最新
- [ ] 脆弱なパッケージがない
- [ ] ログがサニタイズされている
- [ ] エラーメッセージが安全

## アーティファクト

- セキュリティレビューレポート
- 脆弱性リストと修正提案
- セキュリティチェックリストの結果

## 注意事項

- **重要**: 各ステップでユーザーの回答や承認が必要な場合は、必ずユーザーの回答を待ってから次のステップに進むこと。先に進まないこと。
- CRITICAL問題が見つかった場合、即座に停止し、修正を推奨
- セキュリティレビューは、デプロイ前に必ず実行する必要がある
- レビュー結果は、次のフェーズに進む前に承認が必要
